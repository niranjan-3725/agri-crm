{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="flex flex-col xl:flex-row min-h-screen" x-data="{ searchQuery: '{{ request.GET.q|default:'' }}' }">

    <!-- CENTER: Main Content Area -->
    <main class="flex-1 min-w-0 p-6 md:p-10 lg:p-12 pb-32 xl:pb-12">
        <div class="max-w-7xl mx-auto space-y-10">

            <!-- Header -->
            <header class="flex flex-col gap-2">
                <div class="flex items-center gap-2 text-gray-400 text-xs font-bold uppercase tracking-widest">
                    <span class="bg-orange-50 text-orange-600 px-2 py-1 rounded">Catalog</span>
                    <span>â€¢</span>
                    <span>All Products</span>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900 tracking-tight">Product Catalog</h1>

                    <!-- Header Actions -->
                    <div class="flex gap-3 w-full md:w-auto">
                        <form method="get" action="." class="relative flex-1 md:w-72 group">
                            <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-orange-500 transition-colors w-5 h-5"
                                fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            <input type="text" name="q" value="{{ request.GET.q|default:'' }}"
                                placeholder="Search products..."
                                class="w-full bg-white border-2 border-gray-100 focus:border-orange-500/20 rounded-xl py-3 pl-12 pr-4 font-medium text-gray-900 outline-none transition-all placeholder-gray-400 focus:shadow-lg focus:shadow-orange-500/5"
                                hx-get="{% url 'product_list' %}" hx-trigger="keyup changed delay:500ms"
                                hx-target="#product-grid" hx-push-url="true">
                        </form>
                        <a href="{% url 'product_add' %}"
                            class="bg-gray-900 hover:bg-black text-white px-6 py-3 rounded-xl font-bold shadow-lg shadow-gray-900/20 active:scale-95 transition-all flex items-center gap-2 whitespace-nowrap focus:ring-4 focus:ring-orange-500/20">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span class="hidden md:inline">New Product</span>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Product Grid -->
            <div id="product-grid">
                {% include 'master_data/partials/product_table.html' %}
            </div>

        </div>
    </main>

    <!-- RIGHT PANEL: Catalog Stats -->
    <aside class="xl:w-[400px] bg-white border-l border-gray-100 z-40 relative">
        <div class="xl:fixed xl:w-[400px] h-full flex flex-col">

            <div class="p-8 pb-4 border-b border-gray-50 hidden xl:block">
                <h2 class="text-lg font-bold text-gray-900">Catalog Stats</h2>
                <p class="text-sm text-gray-400 mt-1">Inventory overview</p>
            </div>

            <div class="flex-1 p-8 space-y-8 overflow-y-auto">

                <!-- Stats Card -->
                <div
                    class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-[2rem] p-6 shadow-xl shadow-orange-500/20 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="text-orange-100 text-xs font-bold uppercase tracking-widest mb-1">Total Products
                        </div>
                        <div class="text-4xl font-bold tracking-tight mb-4">{{ total_products|intcomma }}</div>
                        <div
                            class="flex items-center gap-2 text-sm font-medium text-white/90 bg-white/10 px-3 py-1.5 rounded-lg w-fit">
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            Active Inventory
                        </div>
                    </div>
                    <div class="absolute -right-6 -top-6 w-32 h-32 bg-white/10 rounded-full blur-xl"></div>
                </div>

                <!-- Top Categories -->
                <div class="space-y-4">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-widest">Top Categories</div>
                    <div class="space-y-3">
                        {% for cat in category_counts %}
                        <div
                            class="flex items-center justify-between p-3 bg-white border border-gray-100 rounded-xl hover:border-orange-100 transition-colors">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-8 h-8 rounded-full bg-orange-50 text-orange-500 flex items-center justify-center">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                                        stroke-width="2">
                                        <path
                                            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                                        </path>
                                    </svg>
                                </div>
                                <div class="text-sm font-bold text-gray-700">{{ cat.name }}</div>
                            </div>
                            <div class="text-sm font-bold text-gray-900">{{ cat.product_count }}</div>
                        </div>
                        {% empty %}
                        <div class="text-sm text-gray-400 italic">No category data</div>
                        {% endfor %}
                    </div>
                </div>

            </div>

            <!-- Bottom Action (Optional, keeping structure consistent with Customer List if needed, but leaving empty or adding Export later if requested. For now, empty or simple filler to match spacing if needed. Customer list uses margin-top-auto) -->
            <!-- Replicating the spacer or bottom section if strictly needed for layout visual match, but user didn't specify a bottom button. Left clean. -->

        </div>
    </aside>

</div>
{% endblock %}