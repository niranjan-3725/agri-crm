{% extends 'base.html' %}

{% block content %}
<style>
    @media print {
        body * {
            visibility: hidden;
        }

        #invoice-area,
        #invoice-area * {
            visibility: visible;
        }

        #invoice-area {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .no-print {
            display: none;
        }
    }
</style>

<div class="max-w-4xl mx-auto bg-white p-8 rounded shadow-lg" id="invoice-area">

    <!-- Header -->
    <div class="border-b pb-6 mb-6">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-4xl font-bold text-slate-800">AgriRetail Shop</h1>
                <p class="text-gray-600">123 Farm Road, Green Valley</p>
                <p class="text-gray-600">Phone: +91 98765 43210</p>
                <p class="text-gray-600">GSTIN: 22AAAAA0000A1Z5</p>
            </div>
            <div class="text-right">
                <h2 class="text-2xl font-bold text-gray-700">INVOICE</h2>
                <p class="text-lg font-mono text-gray-900 mt-2">{{ invoice.invoice_number }}</p>
                <p class="text-gray-600">Date: {{ invoice.date }}</p>
            </div>
        </div>
    </div>

    <!-- Bill To -->
    <div class="mb-8">
        <h3 class="text-gray-600 uppercase tracking-wider text-sm font-bold mb-2">Bill To:</h3>
        {% if invoice.customer %}
        <p class="font-bold text-lg">{{ invoice.customer.name }} - {{ invoice.customer.city|default:"" }}</p>
        <p>{{ invoice.customer.address }}</p>
        <p>Phone: {{ invoice.customer.mobile_no }}</p>
        {% if invoice.customer.gstin %}<p>GSTIN: {{ invoice.customer.gstin }}</p>{% endif %}
        {% else %}
        <p class="italic text-gray-500">Walking Customer</p>
        {% endif %}
    </div>

    <!-- Items -->
    <table class="min-w-full mb-8">
        <thead>
            <tr class="border-b-2 border-slate-800">
                <th class="text-left py-2">Item Description</th>
                <th class="text-right py-2">Batch</th>
                <th class="text-right py-2">Qty</th>
                <th class="text-right py-2">Rate</th>
                <th class="text-right py-2">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in invoice.items.all %}
            <tr class="border-b border-gray-200">
                <td class="py-2">{{ item.batch.product.name }}</td>
                <td class="text-right py-2">{{ item.batch.batch_number }}</td>
                <td class="text-right py-2">{{ item.quantity }}</td>
                <td class="text-right py-2">{{ item.unit_price }}</td>
                <td class="text-right py-2 font-medium">{{ item.total_amount }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Totals -->
    <div class="flex justify-end mb-8">
        <div class="w-1/2">
            <div class="flex justify-between py-2 border-b">
                <span>Taxable Amount</span>
                <span class="font-medium">{{ invoice.total_taxable }}</span>
            </div>
            <div class="flex justify-between py-2 border-b">
                <span>CGST</span>
                <span class="font-medium">{{ invoice.total_cgst }}</span>
            </div>
            <div class="flex justify-between py-2 border-b">
                <span>SGST</span>
                <span class="font-medium">{{ invoice.total_sgst }}</span>
            </div>
            <div class="flex justify-between py-2 text-xl font-bold mt-2">
                <span>Grand Total</span>
                <span>â‚¹{{ invoice.grand_total }}</span>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="text-center text-gray-500 text-sm border-t pt-4">
        <p>Thank you for your business!</p>
        <p>Terms & Conditions Apply.</p>
    </div>

    <!-- Print Button (Hidden in Print) -->
    <div class="mt-8 text-center no-print">
        <button onclick="window.print()" class="bg-gray-800 hover:bg-gray-900 text-white font-bold py-2 px-6 rounded">
            Print Invoice
        </button>
        <a href="{% url 'sales_list' %}" class="ml-4 text-blue-600 hover:underline">Back to Sales</a>
    </div>

</div>
{% endblock %}